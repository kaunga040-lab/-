<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Gyi Kaung - Customer</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        :root { --primary: #1a237e; --accent: #fbc02d; }
        body { font-family: sans-serif; background: #f8f9fa; margin: 0; text-align: center; }
        .container { max-width: 500px; margin: auto; background: white; min-height: 100vh; padding: 20px; }
        .bus-list-item { padding: 15px; border: 2px solid #ddd; border-radius: 12px; margin-bottom: 10px; cursor: pointer; }
        
        .bus-container { background: #263238; padding: 20px; border-radius: 25px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; max-width: 320px; margin: 20px auto; }
        .seat { background: white; padding: 12px 0; border-radius: 8px; font-weight: bold; cursor: pointer; border: 2px solid #3498db; }
        .seat.sold { background: #f44336; color: white; border-color: #b71c1c; cursor: not-allowed; }
        
        /* á€›á€½á€±á€¸á€‘á€¬á€¸á€á€²á€·á€á€¯á€¶ á€œá€¾á€¯á€•á€ºá€”á€±á€…á€±á€›á€”á€º Animation */
        @keyframes shake { 0% {transform: rotate(0)} 25% {transform: rotate(3deg)} 50% {transform: rotate(-3deg)} 100% {transform: rotate(0)} }
        .seat.selected { background: var(--accent); border-color: #f57f17; animation: shake 0.3s infinite; }

        .last-row { grid-column: span 3; display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h2 id="title">á€¡á€€á€¼á€®á€¸á€€á€±á€¬á€„á€º á€€á€¬á€¸á€‚á€­á€á€º</h2>
    
    <div id="trip-list-view">
        <h4>á€€á€¬á€¸á€œá€­á€¯á€„á€ºá€¸á€™á€»á€¬á€¸ á€›á€½á€±á€¸á€á€»á€šá€ºá€•á€«</h4>
        <div id="bus-list"></div>
    </div>

    <div id="booking-view" style="display: none;">
        <button onclick="location.reload()" style="padding: 10px; margin-bottom: 10px;">â† á€›á€¾á€±á€·á€á€­á€¯á€·á€•á€¼á€”á€ºá€á€½á€¬á€¸á€›á€”á€º</button>
        <h3 id="sel-bus-name"></h3>
        <div id="seat-map" class="bus-container"></div>
        <p style="color: #666; font-size: 12px;">(á€á€¯á€¶á€›á€½á€±á€¸á€•á€¼á€®á€¸ Screenshot á€›á€­á€¯á€€á€ºá€•á€­á€¯á€·á€•á€±á€¸á€•á€«)</p>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCOMmiWvHADYvb4ILURBeRo7YDh-Z1sknw",
        authDomain: "a-gyi-kaung.firebaseapp.com",
        databaseURL: "https://a-gyi-kaung-default-rtdb.firebaseio.com",
        projectId: "a-gyi-kaung",
        storageBucket: "a-gyi-kaung.firebasestorage.app",
        messagingSenderId: "1002724874482",
        appId: "1:1002724874482:web:7b08378f45b237cc3f986b"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // á€€á€¬á€¸á€œá€­á€¯á€„á€ºá€¸á€¡á€¬á€¸á€œá€¯á€¶á€¸á€€á€­á€¯ á€•á€¼á€›á€”á€º
    db.ref('trips').on('value', snap => {
        const data = snap.val();
        let html = '';
        for(let id in data) {
            html += `<div class="bus-list-item" onclick="showBus('${id}', '${data[id].name}')">
                <strong>ğŸšŒ ${data[id].name}</strong><br>ğŸ“… ${data[id].date} | â° ${data[id].time}
            </div>`;
        }
        document.getElementById('bus-list').innerHTML = html || 'á€á€›á€®á€¸á€…á€‰á€ºá€™á€›á€¾á€­á€á€±á€¸á€•á€«á‹';
    });

    function showBus(id, name) {
        document.getElementById('trip-list-view').style.display = 'none';
        document.getElementById('booking-view').style.display = 'block';
        document.getElementById('sel-bus-name').innerText = name;
        
        db.ref('bookings/' + id).on('value', snap => {
            const booked = snap.val() || {};
            const map = document.getElementById('seat-map');
            map.innerHTML = '';
            const layout = [['A1','A2','D'],['B1','B2','B3'],['C1','C2','C3'],['D1','D2','D3'],['E1','E2','E3','E4']];
            
            layout.forEach((row, idx) => {
                const target = (idx === 4) ? document.createElement('div') : map;
                if(idx === 4) target.className = 'last-row';
                row.forEach(s => {
                    const div = document.createElement('div');
                    div.className = s === 'D' ? 'seat' : `seat ${booked[s] ? 'sold' : ''}`;
                    div.innerText = s === 'D' ? 'Driver' : s;
                    if(s !== 'D' && !booked[s]) div.onclick = () => div.classList.toggle('selected');
                    if(booked[s]) div.innerText = s + " (Sold)";
                    target.appendChild(div);
                });
                if(idx === 4) map.appendChild(target);
            });
        });
    }
</script>
</body>
</html>
