<!DOCTYPE html><html lang="my">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>AGK System - Trip Management</title><!-- Firebase --><script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script><script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script><script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script><style>
:root{--primary:#1a237e;--secondary:#2e7d32;--danger:#f44336;--dark:#263238;--warning:#ffeb3b}
body{margin:0;font-family:sans-serif;background:#f0f2f5}
.container{max-width:550px;margin:auto;background:#fff;min-height:100vh}
header{background:var(--primary);color:#fff;padding:15px;text-align:center;position:sticky;top:0}
.section{padding:15px}
input,select{width:100%;padding:12px;margin-bottom:10px;border-radius:8px;border:1px solid #ccc}
.btn{width:100%;padding:12px;border:none;border-radius:8px;font-weight:bold;color:#fff;cursor:pointer}
.bus-layout{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;background:#263238;padding:20px;border-radius:20px}
.seat{background:#fff;padding:10px;text-align:center;border-radius:6px;font-weight:bold;cursor:pointer}
.seat.sold{background:#2e7d32;color:#fff}
.seat.locked{background:#ffeb3b}
.driver{background:#555;color:#fff}
#modal,#settings-modal,#report-modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:999}
.modal-content{background:#fff;margin:20px auto;padding:20px;border-radius:15px;width:92%;max-width:450px}
</style></head>
<body><div class="container"><!-- LOGIN --><div id="login-screen" style="padding:100px 20px;text-align:center">
<h2>AGK System</h2>
<input id="login-email" type="email" placeholder="Email" />
<input id="login-pass" type="password" placeholder="Password" />
<button class="btn" style="background:var(--primary)" onclick="login()">Login</button>
<p id="login-error" style="color:red;font-size:12px"></p>
</div><!-- APP --><div id="app-screen" style="display:none">
<header>
<button onclick="openSettings()" style="position:absolute;left:10px;top:15px">âš™ï¸</button>
<button onclick="logout()" style="position:absolute;right:10px;top:15px">Logout</button>
<h3>AGK Ticketing</h3>
<div id="user-display" style="font-size:12px"></div>
</header><div id="admin-only" class="section" style="display:none;background:#e8f5e9">
<input id="bus-name" placeholder="á€€á€¬á€¸á€œá€­á€¯á€„á€ºá€¸á€¡á€™á€Šá€º" />
<input id="bus-date" type="date" />
<button class="btn" style="background:var(--secondary)" onclick="createTrip()">Create Trip</button>
<button class="btn" style="background:#673ab7;margin-top:10px" onclick="showReport()">ğŸ“Š Report</button>
</div><div id="list-area" class="section">
<h4>á€á€›á€®á€¸á€…á€‰á€ºá€™á€»á€¬á€¸</h4>
<div id="bus-list"></div>
</div><div id="booking-area" class="section" style="display:none">
<button onclick="backToList()">â† Back</button>
<h3 id="bus-title"></h3>
<div id="seat-map" class="bus-layout"></div>
</div>
</div>
</div><!-- MODAL --><div id="modal"><div class="modal-content">
<h3 id="seat-label"></h3>
<input id="c-name" placeholder="á€¡á€™á€Šá€º" />
<input id="c-phone" placeholder="á€–á€¯á€”á€ºá€¸" />
<input id="c-price" placeholder="á€ˆá€±á€¸" />
<button class="btn" style="background:var(--secondary)" onclick="saveBooking()">Save</button>
<button class="btn" style="background:#888;margin-top:10px" onclick="closeModal()">Close</button>
</div></div><script>
// Firebase
firebase.initializeApp({
apiKey:"AIzaSyCOMmiWvHADYvb4ILURBeRo7YDh-Z1sknw",
authDomain:"a-gyi-kaung.firebaseapp.com",
databaseURL:"https://a-gyi-kaung-default-rtdb.firebaseio.com",
projectId:"a-gyi-kaung",
appId:"1:1002724874482:web:7b08378f45b237cc3f986b"
});

const auth=firebase.auth();
const db=firebase.database();
let currentTrip=null,selectedSeat=null,userNick="";

// LOGIN
function login(){
const e=document.getElementById('login-email').value;
const p=document.getElementById('login-pass').value;
const err=document.getElementById('login-error');
err.innerText="";
if(!e||!p){err.innerText="Email á€”á€¾á€„á€·á€º Password á€–á€¼á€Šá€·á€ºá€•á€«";return}
auth.signInWithEmailAndPassword(e,p).catch(er=>err.innerText=er.message);
}

function logout(){auth.signOut()}

// AUTH WATCHER
auth.onAuthStateChanged(u=>{
if(u){
userNick=u.email.split('@')[0].toUpperCase();
document.getElementById('login-screen').style.display='none';
document.getElementById('app-screen').style.display='block';
document.getElementById('user-display').innerText='ğŸ‘¤ '+userNick;
if(u.email==='admin@agk.com')document.getElementById('admin-only').style.display='block';
loadTrips();
}else{
document.getElementById('login-screen').style.display='block';
document.getElementById('app-screen').style.display='none';
}
});

// TRIPS
function createTrip(){
const n=bus-name.value,d=bus-date.value;
if(!n||!d)return alert('á€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€•á€¼á€Šá€·á€ºá€…á€¯á€¶á€•á€«');
db.ref('trips/'+Date.now()).set({name:n,date:d});
}

function loadTrips(){
db.ref('trips').on('value',s=>{
let h='';const d=s.val()||{};
Object.keys(d).forEach(id=>{
h+=`<div onclick="openTrip('${id}','${d[id].name}')">ğŸšŒ ${d[id].name} (${d[id].date})</div>`});
bus-list.innerHTML=h||'á€™á€›á€¾á€­á€•á€«';
});
}

function openTrip(id,name){currentTrip=id;bus-title.innerText=name;list-area.style.display='none';booking-area.style.display='block';renderSeats()}
function backToList(){booking-area.style.display='none';list-area.style.display='block'}

function renderSeats(){
const seats=['A1','A2','B1','B2','B3','C1','C2','C3'];
db.ref('bookings/'+currentTrip).once('value',s=>{
seat-map.innerHTML='';const d=s.val()||{};
seats.forEach(se=>{
const div=document.createElement('div');
div.className='seat '+(d[se]?'sold':'');
div.innerText=se;
div.onclick=()=>openSeat(se,d[se]);
seat-map.appendChild(div);
});
});
}

function openSeat(se,data){selectedSeat=se;seat-label.innerText='Seat '+se;if(data){c-name.value=data.name;c-phone.value=data.phone;c-price.value=data.price}else{c-name.value=c-phone.value=c-price.value=''};modal.style.display='block'}
function closeModal(){modal.style.display='none'}

function saveBooking(){
const n=c-name.value,p=c-phone.value,pr=c-price.value;
if(!n||!p||!pr)return alert('á€•á€¼á€Šá€·á€ºá€…á€¯á€¶á€•á€«');
db.ref(`bookings/${currentTrip}/${selectedSeat}`).set({name:n,phone:p,price:pr,soldBy:userNick});
closeModal();renderSeats();
}
</script></body>
             </html>
